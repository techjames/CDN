const constraints={video:!0},video=document.querySelector("video"),icons=getIconics(),dwell=80;var selected_icon=[["",0]],counter=0,criteria="";function gotStream(e){video.srcObject=e,startFaceMask()}function handleError(e){displayError("Failed to start camera! Please allow permission to access camera or switch to &nbsp;<a href='/'>classic view</a>")}function displayError(e=""){""!=e&&$("#errorMsg").html(e),$("#errorMsg").removeClass("d-none")}async function startFaceMask(){return new Promise((e,t)=>{$(".loading").removeClass("d-none"),facemesh.load(maxFaces=1).then(t=>{model=t,$(".loading").addClass("d-none"),console.log("model loaded"),cameraFrame=detectFaces(),e()}).catch(e=>{displayError("Failed to load! Please refresh the page to try again")})})}async function detectFaces(){await model.estimateFaces(document.getElementById("webcam"),!1,!0).then(e=>{navMask(e),cameraFrame=requestAnimationFrame(detectFaces)})}function navMask(e){if(e.length>0)for(let i=0;i<e.length;i++){const a=e[i].scaledMesh;var t=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=t/video.videoWidth,n=c/2.3/video.videoHeight;iconDetect(a[1][0]*o,a[1][1]*n)}}function iconDetect(e,t){for(let c=0;c<icons.length;c++)iconic=document.querySelector("#"+icons[c][0]).getBoundingClientRect(),e>=iconic.left+1&&e<=iconic.right-1&&t>=iconic.top-1&&t<=iconic.bottom+1?($("#"+icons[c][0]).removeClass("recog-off"),selected_icon[0][0]==icons[c][0]&&selected_icon[0][1]>=dwell?("draggable_redo"==selected_icon[0][0]?(criteria="",counter=0,$("#droppable").find("span").html(criteria)):"draggable_search"==selected_icon[0][0]?document.getElementById("face_search").submit():counter<5&&(criteria+=icons[c][1].replace("recog-off",""),$("#droppable").find("span").html(criteria),counter++),selected_icon=[["",0]]):selected_icon[0][0]==icons[c][0]?selected_icon[0][1]++:selected_icon[0][0]=icons[c][0]):$("#"+icons[c][0]).addClass("recog-off")}navigator.mediaDevices.getUserMedia(constraints).then(gotStream).catch(handleError);